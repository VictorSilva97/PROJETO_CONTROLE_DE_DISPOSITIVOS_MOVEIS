CREATE PROCEDURE `pro_verifica_lista_de_espera` ()
BEGIN
	set @maxAparelho = (select Max(id_aparelho) from tbt_aparelhos);
    set @maxfkAparelho= (select FK_ID_MODELO from tbt_aparelhos where id_aparelho =  @maxAparelho);
	   
	set @minFila = (select Min(POSICAO) from tbt_fila_de_espera where fk_id_modelo = @maxfkAparelho ); 
	set @minfkModelo1 = (select FK_ID_MODELO from tbt_fila_de_espera where posicao = @minFila);
    set @idFuncionario = (select FK_ID_FUNCIONARIO from tbt_fila_de_espera where posicao =  @minFila);
    
   
    
    
	
    IF exists(
	   select * from tbt_fila_de_espera fe
			inner join tbt_modelos_de_celular mc
			on mc.id_modelo = fe.fk_id_modelo
		where fe.FK_ID_MODELO = @maxfkAparelho)
     then 
		INSERT INTO tbt_funcionarios_aparelhos (FK_ID_FUNCIONARIO,FK_ID_APARELHO) VALUES(@idFuncionario,@maxAparelho) ;
		delete from tbt_fila_de_espera  Where POSICAO = @minFila;
        set @selecionalinha = (select MIN(ID_LINHA) from tbt_linhas_telefonicas where  FK_ID_APARELHO IS null);
        update  tbt_linhas_telefonicas SET FK_ID_APARELHO = @maxAparelho WHERE ID_LINHA = @selecionalinha;
        
        
	END IF;


END
